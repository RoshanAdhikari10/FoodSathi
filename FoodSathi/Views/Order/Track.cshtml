@model FoodSathi.Models.Order
@{
    ViewData["Title"] = "Track Order | FoodSathi";

    string deliveryType = Model.DeliveryOption ?? "Home Delivery";
    string paymentMethod = Model.PaymentMethod ?? "COD";
    string paymentStatus = Model.PaymentStatus ?? "Pending";

    // 🚚 Delivery timeline steps
    List<string> steps;

    if (deliveryType == "Pickup")
    {
        steps = new List<string> { "Order Placed", "Preparing", "Ready for Pickup", "Picked Up" };
    }
    else // Home Delivery or others
    {
        steps = new List<string> { "Order Placed", "Preparing", "Out for Delivery", "Delivered" };
    }

    // Example current step index (you can later make it dynamic from admin update)
    int currentIndex = paymentStatus == "Completed" ? steps.Count - 1 : 1;
}

<div class="container my-5">
    <div class="card shadow-lg border-0 rounded-4 p-4 text-center">
        <h2 class="fw-bold text-success mb-3">
            <i class="bi bi-truck me-2"></i> Track Your Order
        </h2>

        <div class="mb-4 text-muted">
            <strong>Order ID:</strong> #@Model.OrderID <br />
            <strong>User:</strong> @Model.UserName <br />
            <strong>Item:</strong> @Model.ItemName <br />
            <strong>Quantity:</strong> @Model.Quantity <br />
            <strong>Total:</strong> Rs. @Model.TotalAmount <br />
            <strong>Payment:</strong> @paymentMethod (@paymentStatus) <br />
            <strong>Delivery:</strong> @deliveryType
        </div>

        <!-- 🚚 Dynamic Delivery Progress -->
        <div class="progress-tracker position-relative mt-4 mb-4">
            @for (int i = 0; i < steps.Count; i++)
            {
                var completed = i <= currentIndex ? "completed" : "";
                <div class="step @completed">
                    <div class="circle">
                        <i class="bi @(i < currentIndex ? "bi-check-lg" : "bi-clock")"></i>
                    </div>
                    <p>@steps[i]</p>
                </div>
            }
        </div>

        <!-- 🕒 Delivery Message -->
        <div class="mt-4">
            @if (deliveryType == "Pickup")
            {
                if (currentIndex == 3)
                {
                    <h5 class="text-success fw-bold">🎉 Order Picked Up!</h5>
                    <p class="text-muted">Thank you for collecting your order. Enjoy your meal!</p>
                }
                else if (currentIndex == 2)
                {
                    <h5 class="text-info fw-bold">📦 Ready for Pickup</h5>
                    <p class="text-muted">You can now visit our store to collect your order.</p>
                }
                else
                {
                    <h5 class="text-warning fw-bold">🍳 Preparing Your Order</h5>
                    <p class="text-muted">Our chef is getting your order ready.</p>
                }
            }
            else
            {
                if (currentIndex == 3)
                {
                    <h5 class="text-success fw-bold">🎉 Order Delivered!</h5>
                    <p class="text-muted">Thank you for ordering with FoodSathi!</p>
                }
                else if (currentIndex == 2)
                {
                    <h5 class="text-primary fw-bold">🚚 Out for Delivery</h5>
                    <p class="text-muted">Our delivery partner will reach you soon.</p>
                }
                else
                {
                    <h5 class="text-warning fw-bold">🍳 Preparing Your Order</h5>
                    <p class="text-muted">Your food is being prepared freshly.</p>
                }
            }
        </div>

        <!-- 🔁 Auto Refresh Info -->
        <p class="text-muted small mt-4">(This page auto-refreshes every 10 seconds for live updates)</p>

        <!-- 🔙 Back -->
        <div class="mt-3">
            <a asp-controller="MenuItems" asp-action="Menu" class="btn btn-success px-4 fw-semibold">
                <i class="bi bi-arrow-left me-2"></i> Back to Menu
            </a>
        </div>
    </div>
</div>

<!-- ✅ Bootstrap Icons + Animations -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />

<style>
    .progress-tracker {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        margin: 40px auto;
        max-width: 650px;
    }

        .progress-tracker::before {
            content: "";
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 4px;
            background-color: #e0e0e0;
            z-index: 0;
        }

    .step {
        text-align: center;
        width: calc(100% / 4);
        position: relative;
        z-index: 1;
    }

        .step .circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            margin: 0 auto 10px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            transition: all 0.3s ease;
        }

        .step.completed .circle {
            background-color: #28a745;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }

        .step.completed p {
            color: #28a745;
            font-weight: 600;
        }

        .step p {
            font-size: 0.9rem;
            margin-top: 5px;
            color: #888;
        }
</style>

<script>
    // Auto-refresh every 10 seconds for real-time updates
    setInterval(() => {
        location.reload();
    }, 10000);
</script>
