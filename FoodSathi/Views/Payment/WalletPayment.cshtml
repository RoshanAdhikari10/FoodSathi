@{
    ViewData["Title"] = "Wallet Payment";
    var amount = ViewBag.Amount;
    var fromCart = ViewBag.FromCart ?? false;
    var orderId = ViewBag.OrderId;
}

<div class="container my-5 d-flex justify-content-center align-items-center">
    <div class="card shadow-lg border-0 rounded-5 p-5 text-center" style="max-width: 600px; background: linear-gradient(135deg, #ffffff, #f1f5f9);">
        <h2 class="fw-bold text-primary mb-3">💼 Wallet Payment</h2>
        <p class="text-muted mb-4">Secure and fast payment through your preferred wallet</p>

        <!-- Payment Info -->
        <div class="mb-4 bg-light p-3 rounded-4 shadow-sm">
            @if (fromCart)
            {
                <p class="mb-1 fw-semibold">Payment for Cart Items</p>
            }
            else
            {
                <p class="mb-1 fw-semibold">Order ID: <span class="text-primary">#@orderId</span></p>
            }
            <p class="mb-0 fw-semibold">Total Amount: <span class="text-success">Rs. @amount</span></p>
        </div>

        <!-- Payment Form -->
        <form asp-action="@((fromCart) ? "PayByWalletConfirmFromCart" : "PayByWalletConfirm")" method="post">
            @Html.AntiForgeryToken()

            @if (!fromCart)
            {
                <input type="hidden" name="orderId" value="@orderId" />
            }
            else
            {
                <input type="hidden" name="amount" value="@amount" />
            }

            <div class="form-group mb-4 text-start">
                <label for="walletType" class="fw-semibold mb-2">Select Wallet Type</label>
                <select name="walletType" id="walletType" class="form-select shadow-sm rounded-pill text-center py-2" required onchange="showWalletIdField()">
                    <option value="">-- Choose Wallet --</option>
                    <option value="eSewa">💚 eSewa</option>
                    <option value="Khalti">💜 Khalti</option>
                    <option value="IME Pay">🧡 IME Pay</option>
                </select>
            </div>

            <!-- Dynamic Wallet ID Field -->
            <div class="form-group mb-4" id="walletIdDiv" style="display:none;">
                <label for="walletId" class="fw-semibold mb-2" id="walletIdLabel">Wallet ID</label>
                <input type="text" name="walletId" id="walletId" class="form-control shadow-sm rounded-pill text-center py-2" placeholder="Enter Wallet ID" required />
            </div>

            <button type="submit" class="btn btn-gradient w-100 rounded-pill fw-bold shadow-sm py-2" style="background: linear-gradient(90deg, #28a745, #20c997); color: #fff; font-size: 1.1rem; transition: 0.3s;">
                💸 Confirm Payment
            </button>
        </form>

        <!-- Back Links -->
        <div class="mt-4">
            @if (fromCart)
            {
                <a asp-controller="Cart" asp-action="Index" class="text-secondary text-decoration-none">&larr; Back to Cart</a>
            }
            else
            {
                <a asp-controller="Order" asp-action="Details" asp-route-id="@orderId" class="text-secondary text-decoration-none">&larr; Back to Order</a>
            }
        </div>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success text-center mt-3 shadow-sm rounded-pill">@TempData["Success"]</div>
}

<style>
    /* Premium button hover effect */
    .btn-gradient:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }

    /* Card subtle hover effect */
    .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease-in-out;
    }

    /* Smooth select focus */
    select:focus, input:focus {
        border-color: #20c997;
        box-shadow: 0 0 0 0.2rem rgba(32, 201, 151, 0.25);
        outline: none;
    }
</style>

<script>
    function showWalletIdField() {
        var walletType = document.getElementById('walletType').value;
        var walletDiv = document.getElementById('walletIdDiv');
        var walletLabel = document.getElementById('walletIdLabel');
        var walletInput = document.getElementById('walletId');

        if (walletType === "") {
            walletDiv.style.display = "none";
            walletInput.required = false;
        } else {
            walletDiv.style.display = "block";
            walletInput.required = true;
            walletLabel.innerText = walletType + " ID";
            walletInput.placeholder = "Enter your " + walletType + " ID";
        }
    }
</script>
