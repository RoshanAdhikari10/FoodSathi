@{
    ViewData["Title"] = "Feedback";
}

<div class="container my-5">
    <div class="card shadow-lg border-0 rounded-4 p-4">
        <h2 class="text-center text-primary mb-4">⭐ Product Feedback</h2>

        <!-- Feedback Form -->
        <form id="feedbackForm">
            <div class="mb-3">
                <label class="form-label">Product Name</label>
                <input type="text" class="form-control" id="productName" placeholder="Enter product name" required />
            </div>

            <div class="mb-3">
                <label class="form-label">Your Rating</label>
                <div id="starRating" class="fs-3 text-warning">
                    <i class="bi bi-star" data-value="1"></i>
                    <i class="bi bi-star" data-value="2"></i>
                    <i class="bi bi-star" data-value="3"></i>
                    <i class="bi bi-star" data-value="4"></i>
                    <i class="bi bi-star" data-value="5"></i>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Your Review</label>
                <textarea class="form-control" id="reviewText" rows="3" placeholder="Write your experience..." required></textarea>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-success px-4">Submit Feedback</button>
            </div>
        </form>
    </div>

    <!-- Feedback List -->
    <div class="mt-5">
        <h4 class="text-primary mb-3">💬 Recent Feedback</h4>
        <div id="feedbackList" class="row gy-3"></div>
    </div>
</div>

@section Scripts {
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <script>
        let rating = 0;

        // Handle star click
        document.querySelectorAll('#starRating i').forEach(star => {
            star.addEventListener('click', () => {
                rating = parseInt(star.getAttribute('data-value'));
                document.querySelectorAll('#starRating i').forEach(s => s.classList.replace('bi-star-fill', 'bi-star'));
                for (let i = 0; i < rating; i++) {
                    document.querySelectorAll('#starRating i')[i].classList.replace('bi-star', 'bi-star-fill');
                }
            });
        });

        // Handle form submit
        document.getElementById("feedbackForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const product = document.getElementById("productName").value.trim();
            const review = document.getElementById("reviewText").value.trim();

            if (!product || !review || rating === 0) {
                alert("⚠️ Please complete all fields!");
                return;
            }

            const feedbacks = JSON.parse(localStorage.getItem("feedbacks")) || [];
            feedbacks.push({
                product: product,
                review: review,
                rating: rating,
                date: new Date().toLocaleString()
            });
            localStorage.setItem("feedbacks", JSON.stringify(feedbacks));

            // Reset
            document.getElementById("feedbackForm").reset();
            rating = 0;
            document.querySelectorAll('#starRating i').forEach(s => s.classList.replace('bi-star-fill', 'bi-star'));

            alert("✅ Feedback submitted successfully!");
            loadFeedbacks();
        });

        // Display feedbacks
        function loadFeedbacks() {
            const feedbacks = JSON.parse(localStorage.getItem("feedbacks")) || [];
            const container = document.getElementById("feedbackList");

            if (feedbacks.length === 0) {
                container.innerHTML = `<p class='text-muted'>No feedback yet.</p>`;
                return;
            }

            container.innerHTML = feedbacks.map(f => `
                <div class="col-md-6">
                    <div class="card shadow-sm p-3 border-0">
                        <h5 class="text-success">${f.product}</h5>
                        <p>${'⭐'.repeat(f.rating)}</p>
                        <p class="mb-1">${f.review}</p>
                        <small class="text-muted">${f.date}</small>
                    </div>
                </div>
            `).join('');
        }

        loadFeedbacks();
    </script>
}
